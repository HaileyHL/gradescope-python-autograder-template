#!/usr/bin/env bash

# make_assignment.sh will replace the lines here, DO NOT REMOVE
REPLACE_NAME
REPLACE_SOLUTION
REPLACE_REPO_NAME

BASE_DIR=/autograder/$REPO_NAME

echo "BASE_DIR = $BASE_DIR"

# update git repo
cd $BASE_DIR
git pull
# I think the next line is only necessary if you change the requirements after the first version of the assignment
pip3 install -r $BASE_DIR/requirements.txt

# Go to the solution directory
cd "$BASE_DIR/$NAME/$SOLUTION"

echo "Current directory: $(pwd)"

# Remove all existing files in the solution folder
echo "Removing solution files"
rm -rf ./*

# Copy student submission into the solution folder
echo "Copying student submissions over"
cp -r /autograder/submission/* ./

# List files to confirm
echo "Files in solution directory after copy:"
ls

# Go back to the assignment root
cd "$BASE_DIR/$NAME"

# Run tests
echo "Running test runner"
python3 "$BASE_DIR/gradescope_base/run_tests.py"
echo "Done running test runner"
